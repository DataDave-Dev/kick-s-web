---
const {
    Producto_id,
    Producto,
    Descripcion,
    Precio,
    Cantidad,
    Imagen,
    Categoria,
    Marca,
    Estilo,
} = Astro.props;
---

<div class="rounded-3xl shadow-lg overflow-hidden bg-white flex flex-col hover:shadow-2xl transition-all duration-300 max-w-xs mx-auto sm:max-w-full border border-gray-100">
    <div class="relative">
        <img src={Imagen} alt={Producto} class="w-full h-52 object-cover transition-transform duration-300 hover:scale-105" />
        {
            Cantidad === 0 && (
                <span class="absolute top-3 left-3 bg-gray-900 text-white text-[0.7rem] px-2 py-0.5 rounded-full uppercase tracking-wide opacity-90 font-semibold">
                    Sin stock
                </span>
            )
        }
    </div>

    <div class="p-5 flex flex-col flex-1">
        <h2 class="text-xl font-bold mb-2 text-gray-900 leading-tight">{Producto}</h2>
        <p class="text-gray-500 text-sm mb-3 line-clamp-2">{Descripcion}</p>

        <div class="flex flex-wrap gap-1 text-[0.7rem] mb-3">
            <span class="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full">Marca: <strong>{Marca}</strong></span>
            <span class="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full">Categoría: <strong>{Categoria}</strong></span>
            <span class="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full">Estilo: <strong>{Estilo}</strong></span>
        </div>

        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mt-auto mb-4 gap-2">
            <span class="text-gray-400 text-xs">Disponibles: <strong>{Cantidad}</strong></span>
            <span class="text-2xl font-extrabold text-red-500">
                {
                    Number(Precio).toLocaleString("es-MX", {
                        style: "currency",
                        currency: "MXN",
                    })
                }
            </span>
        </div>

        <button
            type="button"
            class="mt-auto bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-xl shadow-lg transition-all w-full disabled:opacity-50 disabled:cursor-not-allowed"
            disabled={Cantidad === 0}
            onclick={`(function(){
                let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                cart.push({
                    Producto_id: ${JSON.stringify(Producto_id)},
                    Producto: ${JSON.stringify(Producto)},
                    Descripcion: ${JSON.stringify(Descripcion)},
                    Precio: ${JSON.stringify(Precio)},
                    Imagen: ${JSON.stringify(Imagen)},
                    Marca: ${JSON.stringify(Marca)},
                    Categoria: ${JSON.stringify(Categoria)},
                    Estilo: ${JSON.stringify(Estilo)},
                    Cantidad: 1
                });
                localStorage.setItem('cart', JSON.stringify(cart));
                if(window.updateCartCount) window.updateCartCount();
                this.textContent = '¡Agregado!';
                setTimeout(()=>{this.textContent='Agregar al carrito'}, 1000);
            }).call(this)`}
        >
            Agregar al carrito
        </button>
    </div>
</div>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    @media (max-width: 640px) {
        .max-w-xs {
            max-width: 100%;
        }
        .p-5 {
            padding: 1.25rem !important;
        }
        .h-52 {
            height: 13rem !important;
        }
        .text-xl {
            font-size: 1.25rem !important;
        }
        .text-2xl {
            font-size: 1.5rem !important;
        }
    }
</style>
